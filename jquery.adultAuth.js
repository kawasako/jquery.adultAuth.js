// Generated by CoffeeScript 1.7.1

/*
 * jquery.adultAuth.js v0.1
 * https://github.com/kawasako/adultAuth.js
 *
 * Copyright (c) 2014 Kohei Kawasaki
 * Licensed under the MIT license: http://www.opensource.org/licenses/MIT
 */

(function() {
  var AdultAuthHandler, SmoothScroller;

  AdultAuthHandler = (function() {
    AdultAuthHandler.prototype.cookieName = "_adultAuthSession";

    AdultAuthHandler.prototype.adultClass = "is_adult";

    AdultAuthHandler.prototype.notAdultClass = "not_adult";

    AdultAuthHandler.prototype.currentBtnClass = "current";

    function AdultAuthHandler(opt) {
      var cookies, i, str;
      if (typeof opt !== "object") {
        return false;
      }
      if (!(opt.adultBtn || opt.adultContent || opt.notadultBtn || opt.notadultContent)) {
        return false;
      }
      this.SmoothScroller = new SmoothScroller({
        speed: opt.scrollSpeed,
        easing: opt.scrollEasing,
        padding: opt.scrollPadding
      });
      this.$adultBtn = $(opt.adultBtn);
      this.$adultContent = $(opt.adultContent);
      this.$notAdultBtn = $(opt.notAdultBtn);
      this.$notAdultContent = $(opt.notAdultContent);
      this.$adultContent.hide();
      this.$notAdultContent.hide();
      this.isAdult = false;
      if (document.cookie) {
        cookies = document.cookie.split("; ");
        i = 0;
        while (i < cookies.length) {
          str = cookies[i].split("=");
          if (str[0] === this.cookieName && str[1] === this.adultClass) {
            this.isAdult = true;
          }
          i++;
        }
      }
      if (this.isAdult) {
        this.showAdultContent();
      }
      this.listenEvent();
    }

    AdultAuthHandler.prototype.listenEvent = function() {
      var _this;
      _this = this;
      this.$adultBtn.on({
        click: function(event) {
          _this.showAdultContent();
          setTimeout(function() {
            return _this.SmoothScroller.toScroll(_this.$adultContent);
          }, 10);
          return event.preventDefault();
        }
      });
      return this.$notAdultBtn.on({
        click: function(event) {
          _this.showNotAdultContent();
          setTimeout(function() {
            return _this.SmoothScroller.toScroll(_this.$notAdultContent);
          }, 10);
          return event.preventDefault();
        }
      });
    };

    AdultAuthHandler.prototype.showAdultContent = function() {
      this.isAdult = true;
      document.cookie = "" + this.cookieName + "=" + this.adultClass;
      this.$adultBtn.addClass(this.currentBtnClass);
      $('body').addClass(this.adultClass);
      this.$adultContent.show();
      this.$notAdultBtn.removeClass(this.currentBtnClass);
      $('body').removeClass(this.notAdultClass);
      return this.$notAdultContent.hide();
    };

    AdultAuthHandler.prototype.showNotAdultContent = function() {
      this.isAdult = false;
      document.cookie = "" + this.cookieName + "=false";
      this.$adultBtn.removeClass(this.currentBtnClass);
      $('body').removeClass(this.adultClass);
      this.$adultContent.hide();
      this.$notAdultBtn.addClass(this.currentBtnClass);
      $('body').addClass(this.notAdultClass);
      return this.$notAdultContent.show();
    };

    return AdultAuthHandler;

  })();

  SmoothScroller = (function() {
    function SmoothScroller(opt) {
      this.speed = opt.speed ? opt.speed : 640;
      this.easing = opt.easing ? opt.easing : "linear";
      this.padding = opt.padding ? opt.padding : 0;
    }

    SmoothScroller.prototype.toScroll = function($target) {
      var position, ty;
      if (!$target) {
        return false;
      }
      if (!$target[0]) {
        return false;
      }
      position = $target.offset().top;
      ty = Math.min(position, $(document).height() - $(window).height());
      return $("html,body").animate({
        scrollTop: ty
      }, this.speed, this.easing);
    };

    return SmoothScroller;

  })();

  $.extend({
    adultAuth: function(opt) {
      return new AdultAuthHandler(opt);
    }
  });

}).call(this);
